{% extends "base.html" %}

{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Media{% endblock %}


{% block page_content %}

    
    {% block styles %}
    {{super()}}
    <link rel="stylesheet"
        href="{{url_for('static', filename='newstyle.css')}}">
    {% endblock %}
 
    <h1>Search Media</h1>
	<p>You are logged in as <b>{{ current_user.username }}</b>.</p>

	   
<!-- new Boostrap form to be used with AJAX --!>	   

<form id="videoform" name="bootform" form>
	<div id="form_results"></div>
	<fieldset class="form-group">
    <label for="exampleTextarea">Enter search tag:</label>
	<textarea class="form-control" name="tag" id="tagform" rows="1"></textarea>
	<small class="text-muted">*Separate tags with a comma; no tag > 128 characters</small>
  </fieldset>
	<small class="text-muted"></small>
  </fieldset>
  <button type="submit" id="submit_btn" class="btn btn-primary">Submit</button>
</form>

	   <!-- this is the pagination just for the general media load on /media --!>
	   <nav>
		<ul class="pager">
		{% if page > 1 %}
		<li><a href="{{ url_for('main.media', page=(page - 1)) }}"><b>Previous</b></a></li>
        {% endif %}
		<li><a href="{{ url_for('main.media', page=(page + 1)) }}"><b>Next</b></a></li>
      </ul>
    </nav>


	<!-- loop through video_package object for general load on /media --!>
{% for dict in video_package %}

<div class="list-group">
	<a href="http://127.0.0.1:8000/" class="list-group-item active" id="mediaItem--{{loop.index}}">
		<h4 class="list-group-item-heading">{{ dict["name"] }}</h4>
		<img src={{ dict["thumbnail"] }} height="90" width="160">
	  	<p class="list-group-item-text">{{ dict["description"] }}</p>	
   		<p class="list-group-item-text">Some info here</p>
	</a>
</div>

 {% endfor %}


<script>
var form;	
form = document.forms.namedItem("bootform");
form.addEventListener('submit', function(ev) {

	alert("event listener called");


  var oOutput = document.querySelector("div"),
	  oData = new FormData(form);

  alert(oData);

  var oReq = new XMLHttpRequest();
  
  
  oReq.open("POST", "/media", true);
  oReq.onload = function(oEvent) {
	  if (oReq.status == 200) {
		  //alert("200 status");
	  var ovpResponse = oReq.responseText;
		  alert(ovpResponse);
		  //$('#result').html(ovpResponse);

	  //$('form').hide();

		//window.location.replace("https://ovp-frontend-framework.herokuapp.com/uploadsuccess");
      //oOutput.innerHTML = "Uploaded!";
         //local dev:
  		$('#foo').load('/uploadsuccess #foo', function( response, status, xhr  ) {
			if ( oReq.status == "error"  ) { 
			  var msg = "sorry"; 
			  $( "#result" ).html( msg + oReq.status + " " + oReq.statusText  );  
		  }
		  else {
			  $('#result').html(ovpResponse);
		  }
	  });
	  
	  
	  } else {
      oOutput.innerHTML = "Error " + oReq.status + " occurred when trying to upload your file.<br \/>";
    }
  };

  oReq.send(oData);
  ev.preventDefault();
}, false);

</script>



{% endblock %}
