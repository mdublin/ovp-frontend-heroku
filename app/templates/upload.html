{% extends "base.html" %}

{% import "bootstrap/wtf.html" as wtf %}

{% block title %}video upload{% endblock %}


{% block page_content %}
<body background="{{ url_for('static', filename = 'whtntv4.jpg') }}"> 
    
    {% block styles %}
    {{super()}}
    <link rel="stylesheet"
        href="{{url_for('static', filename='newstyle.css')}}">
    {% endblock %}
    <textblock>
	</textblock>
	<h1>Upload new File</h1>


<!-- querySelector() not finding this id, have to use stripped down version of button, which defeats the whole purpose of this --!>
<label class="btn btn-primary" for="my-file-selector">
	<input id="my-file-selector" input type="file" multiple="multiple" style="display:none;"/>Select Video File</label>


<script>
	(function () {
    //for some reason, needed to decalre uploadfiles first, before assigning to querySelector()
    var uploadfiles;
    uploadfiles = document.querySelector('#my-file-selector');
    uploadfiles.addEventListener('change', function () {
		alert("TRIGGER!!!");
		var files = this.files;
        for(var i=0; i<files.length; i++){
			uploadFile(this.files[i]);
			alert(this.files[i]);
        }

    }, false);


    /**
     * Upload a file
     * @param file
     */
	function uploadFile(file){
        var url = "/upload";
        var xhr = new XMLHttpRequest();
        var fd = new FormData();
		xhr.open("POST", url, true);
		xhr.onload = function() {	
	    //xhr.onreadystatechange = function() {
            if (xhr.status == 200) {
		
            //if (xhr.readyState == 4 && xhr.status == 200) {
                // Every thing ok, file uploaded
                console.log(xhr.responseText); // handle response.
				alert("readyState and xhr.status OK");
				location.href="/";
			}
			else{
				alert("readyState and xhr.status NOT OK");
			}
		};

		fd.append('uploaded_file', file);
		alert('uploaded_file', file);
		xhr.send(fd);
    }
}());
</script>

{% endblock %}

